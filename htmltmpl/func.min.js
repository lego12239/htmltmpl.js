/* htmltmpl.func | htmltmpl 3.0.0 | License - GNU LGPL 3 */

{"use strict";htmltmpl.prototype.cb.init.push(function(){this.funcs={};});htmltmpl.prototype.get_data=function(name)
{return this._get_data(name.split("."));}
htmltmpl.prototype._parse_tag_attr_FUNCARGS=function(val)
{if(!Array.isArray(val))
this._throw("attribute ARGS must be an array");return val;}
htmltmpl.prototype.hdlr_func_parse=function(def,attrs)
{if(attrs.ESCAPE==null)
attrs.ESCAPE=def.pafuncs.ESCAPE.call(this,this.p.escape_defval);if(attrs.NAME==null)
this._throw("NAME is a mandatory attribute");this._s.parse[0].push({name:def.name,lineno:this.ctx.lineno,data:{attrs:attrs}});}
htmltmpl.prototype.hdlr_func_apply=function(def,data)
{var attrs;var val;if(this.funcs[data.attrs.NAME]!=undefined){val=this.funcs[data.attrs.NAME].apply(this,data.attrs.ARGS);if(val==null)
return;val=this._escape_tag_attr_val(data.attrs.ESCAPE,val);this.out_str+=val;}else if(this.p.err_on_no_data){this._throw("Cann't find func '%s'.",data.attrs.NAME);}}
htmltmpl.prototype.hdlr_ifret_parse=function(def,attrs)
{if(attrs.NAME==null)
this._throw("NAME is a mandatory attribute");this._s.parse[0].push({name:def.name,lineno:this.ctx.lineno,data:{attrs:attrs}});this._s.parse.unshift([]);}
htmltmpl.prototype.hdlr_ifret_end_parse=function(def)
{var pi;var ifbody,elsebody;ifbody=this._s.parse.shift();pi=this._s.parse[0][this._s.parse[0].length-1];if(!this.is_tag_match(pi.name,def.start_tag))
this._throw("%s was opened, but %s is being closed",pi.name,def.name);if((this._s.priv.length>0)&&(this._s.priv[0].name=="TMPL_ELSE")){elsebody=ifbody;ifbody=this._s.priv[0].prevbody;this._s.priv.shift();}
pi.data.ifbody=ifbody;pi.data.elsebody=elsebody;}
htmltmpl.prototype.hdlr_ifret_apply=function(def,data)
{var attrs;var val,val2;var i;if(this.funcs[data.attrs.NAME]==null)
if(this.p.err_on_no_data)
this._throw("Cann't find func '%s'.",data.attrs.NAME);else
return;val=this.funcs[data.attrs.NAME].apply(this,data.attrs.ARGS);if(val==null){if(data.elsebody!=null)
this._apply(data.elsebody);return;}
if(Array.isArray(val))
this._throw("returned value should be an object");this._s.v.unshift(Object.assign({},this._s.v[0],{data_lookup_depth:2}));this._s.data.unshift(val);this._apply(data.ifbody);this._s.data.shift();this._s.v.shift();}
htmltmpl.prototype.tags["TMPL_FUNC"]={pfunc:htmltmpl.prototype.hdlr_func_parse,afunc:htmltmpl.prototype.hdlr_func_apply,pafuncs:{ARGS:htmltmpl.prototype._parse_tag_attr_FUNCARGS,ESCAPE:htmltmpl.prototype._parse_tag_attr_ESCAPE},name:"TMPL_FUNC"};htmltmpl.prototype.tags["TMPL_IFRET"]={pfunc:htmltmpl.prototype.hdlr_ifret_parse,afunc:htmltmpl.prototype.hdlr_ifret_apply,pafuncs:{ARGS:htmltmpl.prototype._parse_tag_attr_FUNCARGS},name:"TMPL_IFRET"};htmltmpl.prototype.tags["/TMPL_IFRET"]={pfunc:htmltmpl.prototype.hdlr_ifret_end_parse,start_tag:[htmltmpl.prototype.tags["TMPL_IFRET"],htmltmpl.prototype.tags["TMPL_ELSE"]],name:"/TMPL_IFRET"};htmltmpl.prototype.tags["TMPL_ELSE"].start_tag.push(htmltmpl.prototype.tags["TMPL_IFRET"]);}